{% extends 'base.html' %}
{% block content %}
    <div id="plateBarbellRackingDiv">
        <div>
            <h2>
                Calculate the plates you need to load on your barbell
            </h2>
            <h3>
                Enter the lift you want to perform:
            </h3>
            <form action="{% url 'plate barbell racking calculator' %}" method="post">
                {% csrf_token %}
                <div>
                    <div><label for="totalLiftInput">
                        Total Lift
                    </label></div>
                    <div>
                        <div>
                            <div>
                                <input type="number" id="totalLiftInput" name="liftmass" min="1" max="4000" required="required" step="0.1" value="{{ total_lift_mass }}">
                            </div>
                            <div><span>kg</span></div>
                        </div>
                    </div>
                </div>
                <div>
                    <div><label for="barWeightInput">
                        Bar Weight
                    </label></div>
                    <div>
                        <div>
                            <div>
                                <input type="number" id="barWeightInput" name="barliftmass" min="1" max="4000" required="required" step="0.1" value="{{ bar_weight }}">
                            </div>
                            <div><span>kg</span></div>
                        </div>
                    </div>
                </div>
                <br>
                <div>
                    <div></div>
                    <div>
                        <div>
                            <div><input type="submit" value="Calculate Plates" name="calculateTotal"></div>
                        </div>
                    </div>
                </div>
                <br>
                <div>
                    <h3>
                        Customize the plates you have available at your gym (optional):
                    </h3>
                    <table>
                        <thead>
                        <tr>
                            <th width="50%">Plate Weight</th>
                            <th>Quantity (each side)</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr>
                            <td>25 kg</td>
                            <td>
                                <div>
                                    <div>
                                        <input name="plate_quantity_25" type="number" min="0" max="10" value="{{ plate_quantity_25 }}">
                                    </div>
                                </div>
                            </td>
                        </tr>
                        </tbody>
                        <tbody>
                        <tr>
                            <td>20 kg</td>
                            <td>
                                <div>
                                    <div>
                                        <input name="plate_quantity_20" type="number" min="0" max="10" value="{{ plate_quantity_20 }}">
                                    </div>
                                </div>
                            </td>
                        </tr>
                        </tbody>
                        <tbody>
                        <tr>
                            <td>15 kg</td>
                            <td>
                                <div>
                                    <div>
                                        <input name="plate_quantity_15" type="number" min="0" max="10" value="{{ plate_quantity_15 }}">
                                    </div>
                                </div>
                            </td>
                        </tr>
                        </tbody>
                        <tbody>
                        <tr>
                            <td>10 kg</td>
                            <td>
                                <div>
                                    <div>
                                        <input name="plate_quantity_10" type="number" min="0" max="10" value="{{ plate_quantity_10 }}">
                                    </div>
                                </div>
                            </td>
                        </tr>
                        </tbody>
                        <tbody>
                        <tr>
                            <td>5 kg</td>
                            <td>
                                <div>
                                    <div>
                                        <input name="plate_quantity_5" type="number" min="0" max="10" value="{{ plate_quantity_5 }}">
                                    </div>
                                </div>
                            </td>
                        </tr>
                        </tbody>
                        <tbody>
                        <tr>
                            <td>2.5 kg</td>
                            <td>
                                <div>
                                    <div>
                                        <input name="plate_quantity_2_5" type="number" min="0" max="10" value="{{ plate_quantity_2_5 }}">
                                    </div>
                                </div>
                            </td>
                        </tr>
                        </tbody>
                    </table>
                </div>

            </form>
        </div>
        {% if calculator_result_status %}
            <div class="sub_content">
                <div id="plateCalculatorResults">
                    <h2>Plates Calculated</h2>
                    {% if calculator_result_status == 'OK' %}
                        <div>
                            <p>
                                You can make
                                <strong>{{ total_lift_mass }} kg</strong>
                                from
                                <strong>{{ num_of_plates }} plate</strong>
                                each side plus the bar weight of
                                <strong>{{ bar_weight }} kg</strong>.
                            </p>
                            <h3>Each side</h3>
                            <ul>
                                {% for key, value in plates_data.items %}
                                    <li>{{ value }} x {{ key }} kg</li>
                                {% endfor %}
                            </ul>
                            <p>
                                Bar: {{ bar_weight }} kg</p>
                        </div>
                    {% elif calculator_result_status == 'FAIL' %}
                        <div>
                            <p>
                                We couldn't make your lift exactly but you can make
                                <strong>{{ fail_lift_mass }} kg</strong>
                                from
                                <strong>{{ num_of_plates }} plates</strong>
                                each side plus the bar weight of
                                <strong>{{ bar_weight }} kg</strong>.
                            </p>
                            <p>
                                This is
                                <strong>{{ fail_lift_mass_difference }} kg</strong>
                                under your target of
                                <strong>{{ total_lift_mass }} kg .</strong>
                            </p>
                            <h3>Each side</h3>
                            <ul>
                                {% for key, value in plates_data.items %}
                                    <li>{{ value }} x {{ key }} kg</li>
                                {% endfor %}
                            </ul>
                            <p>
                                Bar: {{ bar_weight }} kg</p>
                        </div>
                    {% endif %}
                </div>
            </div>
        {% endif %}
    </div>

    <script>
        let totalLiftInput, barWeightInput;
        document.addEventListener('DOMContentLoaded', () => {
            totalLiftInput = document.getElementById('totalLiftInput');
            barWeightInput = document.getElementById('barWeightInput');
            totalLiftInput.addEventListener('change', (event) => {
                if (totalLiftInput.value === '')
                    totalLiftInput.value = barWeightInput.value;
                else if (parseFloat(totalLiftInput.value) < parseFloat(barWeightInput.value)) {
                    alert('Total lift mass must be greater than bar weight mass')
                    totalLiftInput.value = barWeightInput.value;
                }
            });
            barWeightInput.addEventListener('change', (event) => {
                if (barWeightInput.value === '')
                    barWeightInput.value = totalLiftInput.value;
                else if (parseFloat(totalLiftInput.value) < parseFloat(barWeightInput.value)) {
                    alert('Bar weight mass should be smaller than total lift mass')
                    barWeightInput.value = totalLiftInput.value;
                }
            });
        });
    </script>
{% endblock %}