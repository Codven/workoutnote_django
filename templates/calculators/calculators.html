{% extends 'base.html' %}
{% block content %}
    <div id="rootDiv">
        <div id="calculatorDiv" class="sub_content">
            <div id="header">
                <label id="oneRepMaxButton" class="checked">One Rep Max 계산기<input type="radio" name="calc"></label>
                <label id="plateBarbelButton" class="unchecked">플레이트 바벨 계산기<input type="radio" name="calc"></label>
                <label id="wilksButton" class="unchecked">Wilks 계산기<input type="radio" name="calc"></label>
            </div>
            <div id="oneRepMaxDiv">
                <h3 style="font-weight: bold;">One Rep Max 계산기</h3>
                <span>모든 리프트에 대해 1회당 최대 반복 수를 계산합니다.</span>
                <div id="oneRepMaxCalculator">
                    <div id="oneRepMaxCalculatorForm" action="{% url 'one rep max calculator' %}" method="post">
                        <label for="liftmass" class="label">KG</label>
                        <input type="number" id="liftMass" name="liftMass" min="1" max="1500" required="required" step="0.1" placeholder="직접 입력">

                        <label for="repetitions">반복</label>
                        <input type="number" name="repetitions" id="repetitions" min="1" max="500" placeholder="직접 입력" required="required">

                        <input type="submit" value="계산하기">
                    </div>
                    <div id="oneRepMaxCalculatorResult">
                        <span>딩신의 1RM은</span>
                        <div>
                            <span id="oneRepMaxResult"></span>
                            <span> kg</span>
                        </div>
                        <span>입니다.</span>
                    </div>
                </div>
                {% if calculator_result_status == 'OK' %}
                    <table>
                        <tr>
                            <th>1RM 리프트 중량 백분율</th>
                            <th></th>
                            <th>1RM 반복횟수</th>
                        </tr>
                        {% for result_item in result_table_1 %}
                            <tr>
                                <td>{{ result_item.percentage }}%</td>
                                <td>{{ result_item.liftmass }} kg</td>
                                <td>{{ result_item.reps_of_1rm }}</td>
                            </tr>
                        {% endfor %}
                    </table>
                {% endif %}
            </div>
            <div id="plateBarbellRackingDiv" style="display: none">
                <div>
                    <h2>
                        Calculate the plates you need to load on your barbell
                    </h2>
                    <h3>
                        Enter the lift you want to perform:
                    </h3>
                    <form action="{% url 'plate barbell racking calculator' %}" method="post">
                        {% csrf_token %}
                        <div>
                            <div><label for="totalLiftInput">
                                Total Lift
                            </label></div>
                            <div>
                                <div>
                                    <div>
                                        <input type="number" id="totalLiftInput" name="liftmass" min="1" max="4000" required="required" step="0.1" value="{{ total_lift_mass }}">
                                    </div>
                                    <div><span>kg</span></div>
                                </div>
                            </div>
                        </div>
                        <div>
                            <div><label for="barWeightInput">
                                Bar Weight
                            </label></div>
                            <div>
                                <div>
                                    <div>
                                        <input type="number" id="barWeightInput" name="barliftmass" min="1" max="4000" required="required" step="0.1" value="{{ bar_weight }}">
                                    </div>
                                    <div><span>kg</span></div>
                                </div>
                            </div>
                        </div>
                        <br>
                        <div>
                            <div></div>
                            <div>
                                <div>
                                    <div><input type="submit" value="Calculate Plates" name="calculateTotal"></div>
                                </div>
                            </div>
                        </div>
                        <br>
                        <div>
                            <h3>
                                Customize the plates you have available at your gym (optional):
                            </h3>
                            <table>
                                <thead>
                                <tr>
                                    <th width="50%">Plate Weight</th>
                                    <th>Quantity (each side)</th>
                                </tr>
                                </thead>
                                <tbody>
                                <tr>
                                    <td>25 kg</td>
                                    <td>
                                        <div>
                                            <div>
                                                <input name="plate_quantity_25" type="number" min="0" max="10" value="{{ plate_quantity_25 }}">
                                            </div>
                                        </div>
                                    </td>
                                </tr>
                                </tbody>
                                <tbody>
                                <tr>
                                    <td>20 kg</td>
                                    <td>
                                        <div>
                                            <div>
                                                <input name="plate_quantity_20" type="number" min="0" max="10" value="{{ plate_quantity_20 }}">
                                            </div>
                                        </div>
                                    </td>
                                </tr>
                                </tbody>
                                <tbody>
                                <tr>
                                    <td>15 kg</td>
                                    <td>
                                        <div>
                                            <div>
                                                <input name="plate_quantity_15" type="number" min="0" max="10" value="{{ plate_quantity_15 }}">
                                            </div>
                                        </div>
                                    </td>
                                </tr>
                                </tbody>
                                <tbody>
                                <tr>
                                    <td>10 kg</td>
                                    <td>
                                        <div>
                                            <div>
                                                <input name="plate_quantity_10" type="number" min="0" max="10" value="{{ plate_quantity_10 }}">
                                            </div>
                                        </div>
                                    </td>
                                </tr>
                                </tbody>
                                <tbody>
                                <tr>
                                    <td>5 kg</td>
                                    <td>
                                        <div>
                                            <div>
                                                <input name="plate_quantity_5" type="number" min="0" max="10" value="{{ plate_quantity_5 }}">
                                            </div>
                                        </div>
                                    </td>
                                </tr>
                                </tbody>
                                <tbody>
                                <tr>
                                    <td>2.5 kg</td>
                                    <td>
                                        <div>
                                            <div>
                                                <input name="plate_quantity_2_5" type="number" min="0" max="10" value="{{ plate_quantity_2_5 }}">
                                            </div>
                                        </div>
                                    </td>
                                </tr>
                                </tbody>
                            </table>
                        </div>

                    </form>
                </div>
                {% if calculator_result_status %}
                    <div class="sub_content">
                        <div id="plateCalculatorResults">
                            <h2>Plates Calculated</h2>
                            {% if calculator_result_status == 'OK' %}
                                <div>
                                    <p>
                                        You can make
                                        <strong>{{ total_lift_mass }} kg</strong>
                                        from
                                        <strong>{{ num_of_plates }} plate</strong>
                                        each side plus the bar weight of
                                        <strong>{{ bar_weight }} kg</strong>.
                                    </p>
                                    <h3>Each side</h3>
                                    <ul>
                                        {% for key, value in plates_data.items %}
                                            <li>{{ value }} x {{ key }} kg</li>
                                        {% endfor %}
                                    </ul>
                                    <p>
                                        Bar: {{ bar_weight }} kg</p>
                                </div>
                            {% elif calculator_result_status == 'FAIL' %}
                                <div>
                                    <p>
                                        We couldn't make your lift exactly but you can make
                                        <strong>{{ fail_lift_mass }} kg</strong>
                                        from
                                        <strong>{{ num_of_plates }} plates</strong>
                                        each side plus the bar weight of
                                        <strong>{{ bar_weight }} kg</strong>.
                                    </p>
                                    <p>
                                        This is
                                        <strong>{{ fail_lift_mass_difference }} kg</strong>
                                        under your target of
                                        <strong>{{ total_lift_mass }} kg .</strong>
                                    </p>
                                    <h3>Each side</h3>
                                    <ul>
                                        {% for key, value in plates_data.items %}
                                            <li>{{ value }} x {{ key }} kg</li>
                                        {% endfor %}
                                    </ul>
                                    <p>
                                        Bar: {{ bar_weight }} kg</p>
                                </div>
                            {% endif %}
                        </div>
                    </div>
                {% endif %}
            </div>
            <div id="wilksDiv" style="display: none">
                <div id="wilksContainer">
                    <h2>
                        Calculate the Wilks Score for your gender/bodyweight in kg
                    </h2>
                    <div>
                        <p>
                            The Wilks Score (also known as Wilks Coefficient) measures your strength in powerlifting against
                            other
                            powerlifters with different bodyweights across both genders. It was invented by Robert Wilks of
                            Powerlifting
                            Australia.
                        </p>
                    </div>
                    <form action="{% url 'wilks calculator' %}" method="post" id="powerliftingForm">
                        {% csrf_token %}
                        <div>
                            <div><label for="splitform_gender">성별</label></div>
                            <div>
                                <div>
                                    <div>
                                        <div><select id="splitform_gender" name="gender">
                                            <option value="male">
                                                남성
                                            </option>
                                            <option value="female">
                                                여자
                                            </option>
                                        </select></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div>
                            <div><label for="splitform_bodymass">Bodyweight</label></div>
                            <div>
                                <div>
                                    <div><input type="number" id="splitform_bodymass" name="bodymass" required="required" min="5" max="400" step="0.1"></div>
                                    <div><span>kg</span></div>
                                    <!----></div>
                            </div>
                        </div>
                        <div>
                            <div><label>Method</label></div>
                            <div>
                                <div>
                                    <div>
                                        <label>
                                            <input type="radio" onclick="splitTotalCheck()" name="method" value="split" checked id="splitCheck"> Separately
                                        </label>
                                        <label>
                                            <input type="radio" onclick="splitTotalCheck()" name="method" value="total" id="totalCheck"> AddedUp
                                        </label>
                                    </div>
                                    <p>
                                        Enter your best bench press, squat and deadlift (conventional or sumo)
                                    </p></div>
                            </div>
                        </div>
                        <div id="splitLiftInputBlock">
                            <div>
                                <div><label for="benchliftmass">
                                    Bench Press </label></div>
                                <div>
                                    <div>
                                        <div><input type="number" id="benchliftmass" name="benchliftmass" min="1" max="1500" required="required" step="0.1"></div>
                                        <div><span>kg</span></div>
                                        <div><input type="number" name="benchrepetitions" min="1" max="500"></div>
                                        <div><span>
                            반복
                        </span></div>
                                    </div>
                                </div>
                            </div>
                            <div>
                                <div><label for="squatliftmass">
                                    Back Squat </label></div>
                                <div>
                                    <div>
                                        <div><input type="number" id="squatliftmass" name="squatliftmass" min="1" max="1500" required="required" step="0.1"></div>
                                        <div><span>kg</span></div>
                                        <div><input type="number" name="squatrepetitions" min="1" max="500"></div>
                                        <div><span>
                            반복
                        </span></div>
                                    </div>
                                </div>
                            </div>
                            <div>
                                <div><label for="deadliftliftmass">
                                    Deadlift </label></div>
                                <div>
                                    <div>
                                        <div><input type="number" id="deadliftliftmass" name="deadliftliftmass" min="1" max="1500" required="required" step="0.1"></div>
                                        <div><span>kg</span></div>
                                        <div><input type="number" name="deadliftrepetitions" min="1" max="500"></div>
                                        <div><span>
                            반복
                        </span></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div id="totalLiftInputBlock" style="display: none">
                            <div>
                                <div><label for="totalform_liftmass">
                                    Total Lift
                                </label></div>
                                <div>
                                    <div>
                                        <div><input type="number" id="totalform_liftmass" name="totalliftmass" min="1" max="4000" required="required" step="0.1"></div>
                                        <div><span>kg</span></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <br>
                        <div>
                            <div></div>
                            <div>
                                <div>
                                    <div>
                                        <button type="submit" onclick="submit()">Calculate Score</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
                <br>
                {% if calculator_result_status == 'OK' %}
                    <div class="sub_content">
                        <div id="wilksScoreResults">
                            <h2>Your Wilks Score is
                                <strong>{{ wilks_score }}</strong>
                            </h2>

                            <div>
                                <p>
                                    Based on a total lift of
                                    <strong>
                                        {{ total_lift_mass }} kg </strong>
                                    in bench press, squat and deadlift at a bodyweight of
                                    <strong>
                                        {{ body_weight }} kg </strong>
                                </p>
                            </div>

                            <table>
                                <thead>
                                <tr>
                                    <th width="50%" style="text-align: left;">Level</th>
                                    <th style="text-align: left;">Score</th>
                                </tr>
                                </thead>
                                <tbody>
                                <tr>
                                    <td>Untrained</td>
                                    <td>120</td>
                                </tr>
                                <tr>
                                    <td>Novice</td>
                                    <td>200</td>
                                </tr>
                                <tr>
                                    <td>Intermediate</td>
                                    <td>238</td>
                                </tr>
                                <tr>
                                    <td>Advanced</td>
                                    <td>326</td>
                                </tr>
                                <tr>
                                    <td>Elite</td>
                                    <td>414</td>
                                </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                {% elif calculator_result_status == 'FAIL' %}
                    <!---TODO: place the fail case here--->
                {% endif %}
            </div>
        </div>
        <div id="calculatorInfoRootDiv">
            <div id="calculatorInfoDiv" class="sub_content"></div>
        </div>
    </div>

    <style>
        @media (min-width: 801px) {
            #rootDiv {
                margin: 0;
                padding: 0;
                display: flex;
                justify-content: space-between;
            }

            #calculatorDiv {
                width: calc(65% - 10px);
                min-height: 200px;
                margin: 0;
                padding: 24px;
            }

            #calculatorInfoRootDiv {
                width: calc(35% - 10px);
                margin: 0;
                padding: 0;
                display: inline-block;
            }

            #header {
                display: flex;
                justify-content: space-between;
                margin-bottom: 32px;
            }

            #header label {
                font-weight: bold;
                cursor: pointer;
                flex-grow: 1;
                text-align: center;
            }

            #header input[type=radio] {
                -webkit-appearance: none;
                -moz-appearance: none;
                appearance: none;
            }

            .checked {
                background-color: #5F36C4;
                border-radius: 16px;
                border: 2px solid #5F36C4;
                color: white;
                padding: 4px 8px;
                margin: 4px;
                cursor: pointer;
            }

            .unchecked {
                background-color: white;
                border-radius: 16px;
                color: #5F36C4;
                border: 2px solid #5F36C4;
                padding: 4px 8px;
                margin: 4px;
                cursor: pointer;
            }

            #oneRepMaxCalculator {
                display: flex;
                margin: 32px 0;
                padding: 32px;
                border-radius: 12px;
                color: white;
                background-color: #5F36C4;
                box-shadow: -1px 2px 3px darkgray,
                1px 2px 3px darkgray;
            }

            #oneRepMaxCalculatorForm input[type=number] {
                width: 80%;
            }

            input {
                background-color: inherit;
                color: inherit;
                border: none;
                border-bottom: 2px solid white;
                font-size: small;
                padding: 4px 8px;
            }

            input::placeholder { /* Chrome, Firefox, Opera, Safari 10.1+ */
                color: white;
                opacity: 1; /* Firefox */
            }

            input:-ms-input-placeholder { /* Internet Explorer 10-11 */
                color: white;
            }

            input::-ms-input-placeholder { /* Microsoft Edge */
                color: white;
            }

            #oneRepMaxCalculatorForm {
                display: inline-block;
                flex-grow: 1;
                margin: 0;
                padding: 0;
            }

            #oneRepMaxCalculatorForm label {
                font-weight: bold;
            }

            #liftMass {
                margin-bottom: 24px;
            }

            #oneRepMaxCalculatorForm * {
                display: block;
            }

            #oneRepMaxCalculatorForm input[type=submit] {
                margin-top: 32px;
                display: block;
                width: 80%;
                background-color: white;
                font-size: large;
                font-weight: bold;
                color: #5F36C4;
                border: none;
                border-radius: 32px;
                padding: 4px;
                cursor: pointer;
            }

            #oneRepMaxCalculatorResult {
                display: inline-block;
                width: 70%;
                margin: 0;
                padding: 32px;
            }

            #oneRepMaxCalculatorResult span:first-child {
                font-size: large;
                display: block;
                text-align: start;
            }

            #oneRepMaxCalculatorResult span:last-child {
                font-size: large;
                display: block;
                text-align: end;
            }

            #oneRepMaxCalculatorResult div {
                display: block;
                text-align: center;
            }

            #oneRepMaxCalculatorResult div span:first-child {
                display: inline-block;
                font-size: 50px;
                min-width: 64px;
                border-bottom: 2px solid white;
                text-align: center;
                min-height: 50px;
            }

            #oneRepMaxCalculatorResult div span:last-child {
                display: inline-block;
                font-size: x-large;
            }
        }
    </style>

    <script>
        const ONE_REP_MAX_CONST = 0.025;

        $(document).ready(function () {
            $('#header input[type=radio]').change(function () {
                let p = $('#header input[type=radio]:checked').parent();
                p.removeClass('unchecked');
                p.addClass('checked');
                $.each($('#header input[type=radio]:not(:checked)'), (i, x) => x.parentElement.className = 'unchecked');
            });

            $('#oneRepMaxCalculatorForm input[type=submit]').click(function () {
                let liftMass = parseInt($('#liftMass').val());
                let repetitions = parseInt($('#repetitions').val());

                if (!isNaN(liftMass) && !isNaN(repetitions)) {
                    let oneRepMax = Math.trunc((liftMass + liftMass * repetitions * ONE_REP_MAX_CONST) * 10) / 10;
                    $('#oneRepMaxResult').html(oneRepMax.toString());
                }
            });
        });

        // region plate barbell calculator
        let totalLiftInput, barWeightInput;
        document.addEventListener('DOMContentLoaded', () => {
            totalLiftInput = document.getElementById('totalLiftInput');
            barWeightInput = document.getElementById('barWeightInput');
            totalLiftInput.addEventListener('change', (event) => {
                if (totalLiftInput.value === '')
                    totalLiftInput.value = barWeightInput.value;
                else if (parseFloat(totalLiftInput.value) < parseFloat(barWeightInput.value)) {
                    alert('Total lift mass must be greater than bar weight mass')
                    totalLiftInput.value = barWeightInput.value;
                }
            });
            barWeightInput.addEventListener('change', (event) => {
                if (barWeightInput.value === '')
                    barWeightInput.value = totalLiftInput.value;
                else if (parseFloat(totalLiftInput.value) < parseFloat(barWeightInput.value)) {
                    alert('Bar weight mass should be smaller than total lift mass')
                    barWeightInput.value = totalLiftInput.value;
                }
            });
        });
        // endregion

        // region wilks calculator
        function splitTotalCheck() {
            if (document.getElementById('splitCheck').checked) {
                document.getElementById('totalLiftInputBlock').style.display = 'none';
                document.getElementById('splitLiftInputBlock').style.display = 'block';
            } else {
                document.getElementById('totalLiftInputBlock').style.display = 'block';
                document.getElementById('splitLiftInputBlock').style.display = 'none';
            }
        }

        function submit() {
            document.theForm.submit();
        }

        // endregion

        function hideExerciseSelectorDivClick() {
            selectExerciseDiv.style.display = 'none';
        }
    </script>
{% endblock %}
